# 레드-블랙 트리
레드-블랙 트리(Red-Black Tree)는 이진 탐색 트리(Binary Search Tree)의 일종으로, 노드가 추가되거나 삭제될 때 트리의 균형을 유지함으로써 최악의 경우에도 검색, 삽입, 삭제 등의 연산을 O(log n) 시간 복잡도로 수행할 수 있습니다. 자바에서 자주 사용되는 이 자료구조에 대해 자세히 설명해드리겠습니다.

## 1. 레드-블랙 트리란?
레드-블랙 트리는 자가 균형 이진 탐색 트리(Self-Balancing BST)의 일종입니다. 이 트리는 노드가 추가되거나 삭제될 때 균형을 유지하여 연산의 최악 시간 복잡도를 O(log n)으로 보장합니다. 이를 위해 레드-블랙 트리는 몇 가지 규칙을 따릅니다:

1. **노드는 빨강 또는 검정 색을 가집니다.**
2. **루트 노드는 항상 검정 색입니다.**
3. **모든 리프 노드(NIL)는 검정 색입니다.** (실제 구현에서는 NIL 노드를 사용하지 않기도 함)
4. **빨강 노드의 자식은 항상 검정 색입니다.** (즉, 빨강 노드가 연속으로 두 번 나타날 수 없음)
5. **어떤 노드로부터 시작하여 리프 노드에 도달하는 모든 경로에는 동일한 개수의 검정 노드가 포함됩니다.**

이 규칙들은 트리의 균형을 유지하여 검색, 삽입, 삭제 연산의 시간 복잡도를 O(log n)으로 보장합니다.

## 2. 레드-블랙 트리의 시간 복잡도
레드-블랙 트리의 주요 연산인 검색, 삽입, 삭제는 모두 O(log n) 시간 복잡도를 가집니다. 이는 레드-블랙 트리가 항상 균형 상태를 유지하여, 트리의 높이가 log n에 비례하도록 보장하기 때문입니다.

## 3. 기존 이진 탐색 트리의 한계와 레드-블랙 트리의 등장 배경
기존의 이진 탐색 트리(BST)는 최악의 경우 매우 불균형해질 수 있습니다. 예를 들어, 정렬된 데이터가 삽입될 경우, 트리는 일직선 형태의 리스트처럼 변해 검색, 삽입, 삭제 연산이 O(n) 시간 복잡도를 가지게 됩니다. 이러한 비효율성을 해결하기 위해 등장한 것이 자가 균형 이진 탐색 트리인 레드-블랙 트리입니다. 레드-블랙 트리는 특정 규칙을 통해 트리가 항상 균형 상태에 가까워지도록 합니다.

## 4. 레드-블랙 트리의 동작 방식과 규칙
레드-블랙 트리는 균형을 유지하기 위해 다음과 같은 규칙을 따릅니다:

1. **노드는 빨강 또는 검정 색을 가집니다.**
2. **루트 노드는 항상 검정 색입니다.**
3. **모든 리프 노드(NIL)는 검정 색입니다.**
4. **빨강 노드의 자식은 항상 검정 색입니다.**
5. **어떤 노드로부터 시작하여 리프 노드에 도달하는 모든 경로에는 동일한 개수의 검정 노드가 포함됩니다.**

이 규칙들을 유지함으로써, 트리는 균형을 유지하고, 최악의 경우에도 O(log n) 시간 복잡도를 보장합니다.

## 5. 레드-블랙 트리의 회전 및 재색칠

레드-블랙 트리는 삽입 및 삭제 연산 후 규칙을 위반하는 경우 회전 및 재색칠을 통해 균형을 유지합니다. 주요 연산인 회전과 재색칠에 대해 설명하겠습니다.

### 회전 (Rotation)

회전은 트리의 구조를 재구성하여 균형을 맞추는 연산입니다. 두 가지 유형의 회전이 있습니다:

- **좌회전 (Left Rotation)**: 노드 X가 있을 때, X의 오른쪽 자식 Y를 X의 부모와 연결하고, Y의 왼쪽 자식을 X의 오른쪽 자식으로 이동합니다. Y는 이제 X의 부모가 됩니다.

  ```
      X                   Y
     / \                 / \
    A   Y      -->      X   C
       / \             / \
      B   C           A   B
  ```

- **우회전 (Right Rotation)**: 노드 Y가 있을 때, Y의 왼쪽 자식 X를 Y의 부모와 연결하고, X의 오른쪽 자식을 Y의 왼쪽 자식으로 이동합니다. X는 이제 Y의 부모가 됩니다.

  ```
      Y                   X
     / \                 / \
    X   C      -->      A   Y
   / \                     / \
  A   B                   B   C
  ```

### 재색칠 (Recoloring)

재색칠은 트리의 색을 변경하여 균형을 맞추는 연산입니다. 주로 삽입 또는 삭제 연산 후 특정 규칙을 위반했을 때 수행됩니다.

## 6. 레드-블랙 트리의 삽입 연산

레드-블랙 트리에 노드를 삽입할 때, 다음과 같은 단계를 따릅니다:

1. **일반적인 이진 탐색 트리(BST) 방식으로 노드를 삽입**합니다. 새 노드는 항상 빨강 색으로 설정합니다.
2. **규칙 위반을 확인하고 해결**합니다. (주로 회전 및 재색칠을 통해)

삽입 후 규칙 위반을 해결하는 과정은 다음과 같습니다:

1. **새 노드가 루트인 경우**: 새 노드를 검정 색으로 변경합니다.
2. **새 노드의 부모가 검정 색인 경우**: 트리는 여전히 규칙을 만족하므로 별도의 조치가 필요 없습니다.
3. **새 노드의 부모가 빨강 색인 경우**: 삼촌 노드의 색에 따라 회전과 재색칠을 수행합니다.
    - **삼촌 노드가 빨강 색인 경우**: 부모와 삼촌을 검정 색으로, 할아버지를 빨강 색으로 변경하고, 할아버지를 기준으로 다시 검사합니다.
    - **삼촌 노드가 검정 색인 경우**: 삽입된 노드가 부모의 오른쪽 자식이면서 부모가 할아버지의 왼쪽 자식인 경우, 좌회전 후 우회전(혹은 그 반대)을 수행합니다. 이후 부모와 할아버지의 색을 교환합니다.

## 7. 레드-블랙 트리의 삭제 연산

레드-블랙 트리에서 노드를 삭제할 때도 비슷한 과정을 따릅니다. 삭제 후에도 트리가 균형을 유지하도록 회전 및 재색칠이 필요합니다.

삭제 과정은 복잡하지만 기본적인 절차는 다음과 같습니다:

1. **일반적인 이진 탐색 트리(BST) 방식으로 노드를 삭제**합니다.
2. **삭제 후 트리가 균형을 유지하도록 규칙을 확인하고 해결**합니다.

- **삭제된 노드가 검정 색인 경우**: 규칙 5가 위반될 수 있으므로 추가 조치가 필요합니다.
- **삭제된 노드가 루트인 경우**: 별도의 조치가 필요 없습니다.
- **기타 경우**: 형제 노드와 조부모 노드의 색을 기준으로 다양한 회전 및 재색칠 작업을 수행합니다.

## 8. 자바에서 레드-블랙 트리의 활용
자바에서는 `java.util` 패키지 내의 `TreeMap`과 `TreeSet`이 레드-블랙 트리를 기반으로 구현되어 있습니다. `TreeMap`은 키-값 쌍을 저장하는데 사용되며, `TreeSet`은 중복을 허용하지 않는 정렬된 집합을 구현합니다.

- **TreeMap**: 키-값 쌍을 저장하는 맵 자료구조로, 키가 항상 정렬된 상태로 유지됩니다. 삽입, 삭제, 검색 등의 연산이 O(log n) 시간 복잡도를 가집니다.
- **TreeSet**: 중복을 허용하지 않는 정렬된 집합을 제공하며, 내부적으로 레드-블랙 트리를 사용하여 요소가 항상 정렬된 상태로 유지됩니다.

## 9. 레드-블랙 트리의 단점과 대안 자료구조
레드-블랙 트리의 단점은 트리의 높이가 완벽하게 균형 잡히지 않기 때문에 일부 연산에서 AVL 트리보다 더 많은 회전이 필요할 수 있다는 점입니다. AVL 트리는 모든 노드의 균형 인수(balance factor)가 -1, 0, 1 이내로 유지되도록 보장하여, 더 엄격하게 균형을 유지하지만, 삽입과 삭제 연산에서 더 많은 회전이 필요할 수 있습니다.

- **AVL 트리**: 레드-블랙 트리와 달리 노드의 높이 균형을 엄

격하게 유지하는 자가 균형 이진 탐색 트리입니다. 모든 노드에 대해 왼쪽 서브트리와 오른쪽 서브트리의 높이 차이가 최대 1이 되도록 유지합니다. 이는 검색 연산에서 더 나은 성능을 보장할 수 있지만, 삽입 및 삭제 연산에서는 더 많은 트리 회전이 발생할 수 있습니다.

## 10. 왜 자바와 코틀린에서 레드-블랙 트리를 사용하는가?

자바와 코틀린의 표준 라이브러리에서 AVL 트리가 아닌 레드-블랙 트리를 선택한 주된 이유는 AVL 트리보다 삽입과 삭제 연산이 더 효율적이기 때문입니다. AVL 트리는 모든 노드의 균형을 엄격하게 유지하기 때문에 트리의 균형을 맞추기 위해 더 많은 회전이 필요합니다. 이는 검색 속도는 더 빠를 수 있지만, 빈번한 삽입과 삭제가 일어나는 환경에서는 오히려 성능 저하를 초래할 수 있습니다.

반면 레드-블랙 트리는 트리의 균형을 비교적 느슨하게 유지하여 회전 횟수를 줄입니다. 따라서 삽입 및 삭제 연산에서 더 나은 성능을 발휘합니다. 이러한 이유로 실시간 데이터 추가와 삭제가 빈번한 상황에서는 레드-블랙 트리가 더 적합한 선택입니다.

## 요약
레드-블랙 트리는 이진 탐색 트리의 단점을 보완하여 항상 균형을 유지함으로써 삽입, 삭제, 검색 연산의 시간 복잡도를 O(log n)으로 보장하는 자가 균형 이진 탐색 트리입니다. 자바에서는 `TreeMap`과 `TreeSet`에서 이 자료구조를 활용하며, 삽입 및 삭제 연산 후 규칙을 유지하기 위해 회전과 재색칠을 통해 트리의 균형을 유지합니다. AVL 트리와 비교했을 때, 각각의 장단점이 있으므로 사용 상황에 따라 적절한 자료구조를 선택하는 것이 중요합니다. 특히 자바와 코틀린에서는 삽입과 삭제 연산에서 효율적인 레드-블랙 트리를 표준 라이브러리에서 제공합니다.